<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Restoran</title>
    <link
      crossorigin="anonymous"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .container {
        margin-top: 20px;
      }
      .order-summary {
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .order-summary img {
        width: 50px;
        height: 50px;
        border-radius: 5px;
      }
      .order-summary .btn {
        width: 100%;
      }
      .order-summary .total {
        font-size: 1.5rem;
        font-weight: bold;
      }
      .order-summary .back-to-cart {
        text-decoration: none;
        color: #007bff;
      }
      .order-summary .back-to-cart:hover {
        text-decoration: underline;
      }
      .country-code-wrapper {
        position: relative;
        display: flex;
        align-items: center;
      }
      #country-code {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-repeat: no-repeat;
        background-position: left 10px center;
        background-size: 25px 20px;
        padding-left: 40px;
        padding-right: 40px;
        width: 100%;
        height: 38px;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        background-color: #fff;
      }
      .country-code-wrapper::after {
        content: "\f078";
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        position: absolute;
        right: 15px;
        pointer-events: none;
        color: #6c757d;
      }

      #country-code {
        background-size: 20px 15px;
        background-repeat: no-repeat;
        background-position: left 10px center;
        padding-left: 40px; /* Space for flag */
      }

      .country-code-wrapper select {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      select::-ms-expand {
        display: none;
      }
      .order-summary h4 {
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
      }
      .order-summary .form-check {
        margin-bottom: 20px;
      }
      .order-summary .form-check i {
        color: #28a745;
      }
      .order-summary .cart-summary p {
        font-weight: bold;
      }
      .order-summary .back-to-cart {
        display: inline-block;
        margin-top: 10px;
      }
      .vietnam-address {
        display: none;
      }
      .general-address {
        display: none;
      }
      .input-group {
        gap: 10px;
      }
      .order-summary .totals {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .order-summary .totals p {
        margin-bottom: 0;
      }

      .order-summary .totals .total-price {
        flex-shrink: 0;
        margin-left: auto; /* Push price to the right */
        text-align: right; /* Align text to the right */
      }

      .order-summary .mb-3 {
        display: flex;
        justify-content: space-between;
      }

      .order-summary .mb-3 p {
        margin-bottom: 0;
      }

      .order-summary .mb-3 .subtotal-price,
      .order-summary .mb-3 .shipping-fee-price {
        flex-shrink: 0;
        margin-left: auto; /* Push price to the right */
        text-align: right; /* Align text to the right */
      }

      .cart-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .cart-item .item-left {
        display: flex;
        align-items: center;
        gap: 10px; /* Space between image and title */
      }

      .cart-item .item-left img {
        width: 50px;
        height: 50px;
        border-radius: 5px;
      }

      .cart-item .item-title {
        font-size: 1rem;
        text-align: left; /* Align left */
      }

      .cart-item .item-price {
        flex-shrink: 0; /* Do not shrink */
        margin-left: auto; /* Push to the right */
        text-align: right; /* Align right */
        white-space: nowrap; /* Prevent line break for price */
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <!-- Shipping Information Form -->
        <div class="col-md-7">
          <h2 class="text-primary">Restoran</h2>
          <form id="order-form">
            <h4>Shipping Information</h4>
            <!-- Country Selection Dropdown -->
            <div class="mb-3">
              <label class="form-label" for="country"
                >Country <span class="text-danger">*</span></label
              >
              <select class="form-select" id="country" required>
                <option value="">--- Select Country ---</option>
                <option value="Vietnam">Vietnam</option>
                <option value="USA">USA</option>
                <option value="Japan">Japan</option>
                <!-- Add other countries if needed -->
              </select>
            </div>
            <!-- Fields for Vietnam -->
            <div id="vietnam-address" class="vietnam-address">
              <div class="mb-3">
                <label class="form-label" for="city"
                  >Province/City <span class="text-danger">*</span></label
                >
                <select class="form-select" id="city" required>
                  <option value="">--- Select Province/City ---</option>
                  <!-- Provinces/Cities will be added via JavaScript -->
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label" for="district"
                  >District (optional)</label
                >
                <select class="form-select" id="district" disabled>
                  <option value="">--- Select District ---</option>
                  <!-- Districts will be added via JavaScript -->
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label" for="ward"
                  >Ward (optional)</label
                >
                <select class="form-select" id="ward" disabled>
                  <option value="">--- Select Ward ---</option>
                  <!-- Wards will be added via JavaScript -->
                </select>
              </div>
            </div>
            <!-- Fields for Other Countries -->
            <div id="general-address" class="general-address">
              <div class="mb-3">
                <label class="form-label" for="address-general"
                  >Address <span class="text-danger">*</span></label
                >
                <input
                  class="form-control"
                  id="address-general"
                  type="text"
                  placeholder="Address"
                  required
                />
              </div>
            </div>
            <!-- Other Fields -->
            <div class="mb-3">
              <label class="form-label" for="email"
                >Email <span class="text-danger">*</span></label
              >
              <input
                class="form-control"
                id="email"
                type="email"
                placeholder="Email"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label" for="name"
                >Full Name <span class="text-danger">*</span></label
              >
              <input
                class="form-control"
                id="name"
                type="text"
                placeholder="Full Name"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label" for="phone"
                >Phone Number <span class="text-danger">*</span></label
              >
              <div class="input-group">
                <div class="country-code-wrapper me-2" style="flex: 0 0 180px">
                  <select class="form-select" id="country-code" required>
                    <option value="">---Select Country Code---</option>
                    <option value="+84" data-flag="img/co_vn.png">
                      Vietnam (+84)
                    </option>
                    <option value="+1" data-flag="img/co_usa.png">
                      USA (+1)
                    </option>
                    <option value="+81" data-flag="img/co_japan.jpg">
                      Japan (+81)
                    </option>
                    <!-- Add other countries if needed -->
                  </select>
                </div>
                <input
                  class="form-control"
                  id="phone"
                  type="text"
                  placeholder="Phone Number"
                  required
                />
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label" for="note"
                >Note <span class="text-danger">*</span></label
              >
              <textarea
                class="form-control"
                id="note"
                rows="3"
                placeholder="Note"
                required
              ></textarea>
            </div>
            <button class="btn btn-primary mt-3" id="place-order" type="submit">
              PLACE ORDER
            </button>
          </form>
        </div>
        <!-- Cart and Payment -->
        <div class="col-md-5">
          <div class="order-summary">
            <h4>Shipping</h4>
            <div class="alert alert-info">
              Please enter shipping information
            </div>
            <h4>Payment</h4>
            <div class="form-check">
              <input
                class="form-check-input"
                id="cod"
                name="payment"
                type="radio"
                value="COD"
                checked
              />
              <label class="form-check-label" for="cod">
                Cash on Delivery (COD)
              </label>
              <i class="fas fa-money-bill-wave ms-2"></i>
            </div>
            <h4 class="mt-4">
              Order (<span id="item-count">0</span> products)
            </h4>
            <div id="cartItemsContainer">
              <!-- Cart items will be displayed here -->
            </div>
            <div class="mb-3">
              <div class="input-group">
                <input
                  class="form-control"
                  id="discount-code"
                  type="text"
                  placeholder="Enter discount code"
                />
                <button class="btn btn-primary" id="apply-discount">
                  Apply
                </button>
              </div>
            </div>
            <div class="mb-3">
              <p class="mb-0">Subtotal</p>
              <p class="mb-0 subtotal-price" id="subtotal">0₫</p>
            </div>
            <div class="mb-3">
              <p class="mb-0">Shipping Fee</p>
              <p class="mb-0 shipping-fee-price" id="shipping-fee">-</p>
            </div>
            <div class="mb-3 totals">
              <p class="mb-0">Total</p>
              <p class="mb-0 total-price" id="total">0₫</p>
            </div>

            <a class="back-to-cart" href="menu.html">Back to Cart</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Successful Modal -->
    <div
      class="modal fade"
      id="orderSuccessModal"
      tabindex="-1"
      aria-labelledby="orderSuccessModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title" id="orderSuccessModalLabel">
              Order Successful
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>Thank you for ordering at Restoran!</p>
            <p>
              We will contact you as soon as possible to confirm your order.
            </p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-primary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Order Successful Modal End -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
          // ... mã hiện tại ...
      
          // Dữ liệu giỏ hàng từ localStorage
          const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
          let totalAmount = parseInt(localStorage.getItem("totalAmount")) || 0;
          let discount = 0;
      
          const cartItemsContainer = document.getElementById("cartItemsContainer");
          const itemCountSpan = document.getElementById("item-count");
          const subtotalP = document.getElementById("subtotal");
          const shippingFeeP = document.getElementById("shipping-fee");
          const totalP = document.getElementById("total");
          const applyDiscountButton = document.getElementById("apply-discount");
          const discountCodeInput = document.getElementById("discount-code");
          const orderForm = document.getElementById("order-form");
      
          // Hàm hiển thị giỏ hàng
          function displayCartItems() {
            cartItemsContainer.innerHTML = ""; // Xóa nội dung hiện tại
            if (cartItems.length === 0) {
              cartItemsContainer.innerHTML = "<p>Your cart is empty.</p>";
              itemCountSpan.textContent = "0";
              subtotalP.textContent = "0₫";
              shippingFeeP.textContent = "-";
              totalP.textContent = "0₫";
              return;
            }
      
            let itemCount = 0;
            let calculatedSubtotal = 0; // Biến mới để tính lại subtotal
      
            cartItems.forEach((item) => {
              const itemTotal = item.price * item.quantity;
              itemCount += item.quantity; // Tăng itemCount theo số lượng sản phẩm
              calculatedSubtotal += itemTotal; // Cộng vào subtotal
      
              const itemDiv = document.createElement("div");
              itemDiv.classList.add("cart-item");
      
              itemDiv.innerHTML = `
                <div class="item-left">
                  <img src="${item.image}" alt="${item.title}" />
                  <div class="item-title">
                    <p class="mb-0">${item.title}</p>
                    <p class="mb-0">${item.price.toLocaleString()}₫ x ${item.quantity}</p>
                  </div>
                </div>
                <div class="item-price">
                  ${itemTotal.toLocaleString()}₫
                </div>
              `;
              cartItemsContainer.appendChild(itemDiv);
            });
      
            itemCountSpan.textContent = itemCount;
            subtotalP.textContent = `${calculatedSubtotal.toLocaleString()}₫`;
            shippingFeeP.textContent = "-";
            totalP.textContent = `${(calculatedSubtotal - discount).toLocaleString()}₫`;
          }
      
          // Xử lý áp dụng mã giảm giá
          applyDiscountButton.addEventListener("click", (e) => {
            e.preventDefault(); // Ngăn hành động mặc định của nút
            const code = discountCodeInput.value.trim();
            if (code === "") {
              alert("Please enter a discount code.");
              return;
            }
      
            // Kiểm tra mã giảm giá (ví dụ: "DISCOUNT10" cho giảm 10%)
            if (code === "DISCOUNT10") {
              discount = calculatedSubtotal * 0.1;
              alert("Discount code applied successfully! You get a 10% discount.");
            } else if (code === "DISCOUNT20") {
              discount = calculatedSubtotal * 0.2;
              alert("Discount code applied successfully! You get a 20% discount.");
            } else {
              discount = 0;
              alert("Invalid discount code.");
            }
      
            totalP.textContent = `${(calculatedSubtotal - discount).toLocaleString()}₫`;
          });
      
          // Hàm hiển thị modal thành công đơn hàng
          function showOrderSuccessModal() {
            var orderSuccessModal = new bootstrap.Modal(
              document.getElementById("orderSuccessModal")
            );
            orderSuccessModal.show();
          }
      
          // Xử lý gửi đơn hàng
          orderForm.addEventListener("submit", (e) => {
            e.preventDefault(); // Ngăn gửi form mặc định
            if (cartItems.length === 0) {
              alert("Your cart is empty.");
              return;
            }
      
            // Lấy thông tin vận chuyển từ form
            const email = document.getElementById("email").value.trim();
            const name = document.getElementById("name").value.trim();
            const phone = document.getElementById("phone").value.trim();
            const country = document.getElementById("country").value.trim();
            let city, district, ward, addressGeneral;
            if (country === "Vietnam") {
              city = document.getElementById("city").value.trim();
              district = document.getElementById("district").value.trim();
              ward = document.getElementById("ward").value.trim();
            } else {
              addressGeneral = document
                .getElementById("address-general")
                .value.trim();
            }
            const note = document.getElementById("note").value.trim();
            const paymentMethod = document.querySelector(
              'input[name="payment"]:checked'
            ).value;
      
            // Kiểm tra các trường bắt buộc
            if (
              email === "" ||
              name === "" ||
              phone === "" ||
              note === "" ||
              (country === "Vietnam" && city === "") ||
              (country !== "Vietnam" && addressGeneral === "")
            ) {
              alert(
                "Please fill in all required information (Email, Full Name, Phone Number, Note, Province/Address)."
              );
              return;
            }
      
            // Kiểm tra định dạng số điện thoại (chỉ số và độ dài từ 10-15 chữ số)
            const phonePattern = /^[0-9]{10,15}$/;
            if (!phonePattern.test(phone)) {
              alert("Please enter a valid phone number (10-15 digits).");
              return;
            }
      
            // TODO: Thêm xử lý gửi đơn hàng tới server hoặc lưu trữ thông tin đơn hàng
            // Ví dụ: Gửi thông tin đơn hàng qua AJAX tới server
      
            // Hiển thị modal thành công đơn hàng
            showOrderSuccessModal();
      
            // Xóa dữ liệu giỏ hàng khỏi localStorage
            localStorage.removeItem("cartItems");
            localStorage.removeItem("totalAmount");
      
            // Cập nhật giao diện giỏ hàng
            displayCartItems();
      
            // Reset form
            orderForm.reset();
            discount = 0;
            totalP.textContent = "0₫";
      
            // Ẩn các trường địa chỉ
            vietnamAddress.style.display = "none";
            generalAddress.style.display = "none";
          });
      
          // Khởi tạo giỏ hàng khi trang tải
          displayCartItems();
      
          // Hàm khởi tạo các trường địa chỉ Việt Nam
          toggleAddressFields(countrySelect.value);
        });
      </script>
      
  </body>
</html>
